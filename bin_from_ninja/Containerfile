FROM docker.io/library/debian:bookworm-20230904

# Remark: `synchronize_backup` and `synchronize_partially` call `rsync` and `time`.
RUN apt update && apt install -y curl rsync time

# Remark: To install `pixi` on your PC, if `cargo` is already installed, then you
#   can call `cargo install pixi --version 0.2.0 --locked` instead.
RUN curl -fsSL https://pixi.sh/install.sh | PIXI_VERSION=v0.2.0 bash

# Remark: On your PC, in your `.bashrc`, add `export PATH="$PATH:$HOME/.pixi/bin"`.
ENV PATH="$PATH:/root/.pixi/bin"

WORKDIR /app
COPY pixi.toml pixi.lock /app

# Remark: `pixi run all` already does `pixi install` if needed. But, in the
#   `Containerfile`, it is better to have the result in a cache before `COPY . /app`.
RUN pixi install

COPY . /app
RUN pixi run all

# Remark: On your PC, in your `.bashrc`, add `export PATH="$PATH:$HOME/bin"` so that
#   you can use `synchronize_backup`, `synchronize_partially`, etc.
ENV PATH="$PATH:/root/bin"

CMD /bin/bash
